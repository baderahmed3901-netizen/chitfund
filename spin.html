<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spin Winner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    
    body {
      background: #000;
      color: #fff;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      overflow: hidden;
    }

    #particles-canvas {
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    .main-container {
      position: relative;
      z-index: 10;
      background: #000;
      border: 1.5px solid #fff;
      border-radius: 1.5rem;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }

    .spinner-arrow {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 28px solid #fff;
      z-index: 20;
    }

    .wheel-wrapper {
      position: relative;
      width: 300px;
      height: 300px;
    }

    @media (min-width: 640px) {
      .wheel-wrapper { width: 380px; height: 380px; }
    }

    canvas#spinCanvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  <canvas id="particles-canvas"></canvas>

  <div class="main-container max-w-sm w-full p-8 flex flex-col items-center space-y-8 text-center">
    <div>
      <h1 class="text-3xl font-bold uppercase tracking-tighter">Spin Winner</h1>
      <p class="text-gray-400 text-xs tracking-widest mt-1">OFFICIAL MONTHLY DRAW</p>
    </div>

    <div class="wheel-wrapper">
      <div class="spinner-arrow"></div>
      <canvas id="spinCanvas"></canvas>
    </div>

    <div class="w-full space-y-6">
      <div class="border border-white/20 py-4 px-4 rounded-lg bg-white/5">
        <p class="text-[10px] font-bold uppercase text-gray-500">Selected Winner</p>
        <div id="winner-text" class="text-2xl font-extrabold uppercase mt-1">Waiting...</div>
      </div>

      <div class="text-[10px] text-gray-500 uppercase tracking-widest">
        Next Draw: <span id="countdown-timer" class="text-white font-mono">--:--:--</span>
      </div>
    </div>
  </div>

<script>
(function () {
  /* --- Particles Background --- */
  const bgCanvas = document.getElementById('particles-canvas');
  const bgCtx = bgCanvas.getContext('2d');
  let particles = [];

  function initParticles() {
    bgCanvas.width = window.innerWidth;
    bgCanvas.height = window.innerHeight;
    particles = [];
    for (let i = 0; i < 50; i++) {
      particles.push({
        x: Math.random() * bgCanvas.width,
        y: Math.random() * bgCanvas.height,
        vx: Math.random() * 0.3 - 0.15,
        vy: Math.random() * 0.3 - 0.15,
        r: Math.random() * 1.2
      });
    }
  }

  function animateParticles() {
    bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
    bgCtx.fillStyle = 'rgba(255, 255, 255, 0.4)';
    particles.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      if (p.x < 0) p.x = bgCanvas.width;
      if (p.x > bgCanvas.width) p.x = 0;
      if (p.y < 0) p.y = bgCanvas.height;
      if (p.y > bgCanvas.height) p.y = 0;
      bgCtx.beginPath();
      bgCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      bgCtx.fill();
    });
    requestAnimationFrame(animateParticles);
  }

  /* --- Spin Wheel Logic --- */
  const names = ['amul', 'parkline', 'Khatija', 'Habeeba', 'Mariya', 'Labeeba', 'basith'];
  const canvas = document.getElementById('spinCanvas');
  const ctx = canvas.getContext('2d');
  const winnerText = document.getElementById('winner-text');
  const countdown = document.getElementById('countdown-timer');

  let size, center, radius;

  function setupWheel() {
    size = canvas.offsetWidth * 2; 
    canvas.width = size;
    canvas.height = size;
    center = size / 2;
    radius = size / 2;
    drawWheel(0);
  }

  function drawWheel(rotation = 0) {
    const arc = (Math.PI * 2) / names.length;
    ctx.clearRect(0, 0, size, size);

    // Draw Outer Border
    ctx.beginPath();
    ctx.arc(center, center, radius - 2, 0, Math.PI * 2);
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 4;
    ctx.stroke();

    names.forEach((name, i) => {
      const angle = i * arc + rotation;
      
      // Draw Slice Lines
      ctx.beginPath();
      ctx.moveTo(center, center);
      ctx.lineTo(center + Math.cos(angle) * radius, center + Math.sin(angle) * radius);
      ctx.strokeStyle = 'rgba(255,255,255,0.5)';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Draw Text
      ctx.save();
      ctx.translate(center, center);
      ctx.rotate(angle + arc / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#fff";
      
      const fontSize = size / 22;
      ctx.font = `bold ${fontSize}px Inter`;
      const padding = size / 15; 
      ctx.fillText(name.toUpperCase(), radius - padding, fontSize / 3);
      ctx.restore();
    });

    ctx.beginPath();
    ctx.arc(center, center, 8, 0, Math.PI * 2);
    ctx.fillStyle = "#fff";
    ctx.fill();
  }

  async function spinToWinner(targetName) {
    winnerText.textContent = "Spinning...";
    const index = names.indexOf(targetName);
    const segmentDeg = 360 / names.length;
    
    const landingPoint = 270 - (index * segmentDeg) - (segmentDeg / 2);
    const totalRotation = landingPoint + (360 * 10); 

    const duration = 5000;
    const start = performance.now();

    function animate(now) {
      const elapsed = now - start;
      const progress = Math.min(elapsed / duration, 1);
      const easeOut = 1 - Math.pow(1 - progress, 4);
      
      drawWheel((easeOut * totalRotation) * Math.PI / 180);

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        winnerText.textContent = targetName.toUpperCase();
        // Update storage timestamp only on a real draw if you wish, 
        // but here it updates every reload to keep timer active.
        localStorage.setItem('drawTimestamp', Date.now());
      }
    }
    requestAnimationFrame(animate);
  }

  function updateTimer() {
    const last = parseInt(localStorage.getItem('drawTimestamp')) || Date.now();
    const next = last + (30 * 24 * 60 * 60 * 1000);
    const diff = next - Date.now();

    if (diff <= 0) {
      countdown.textContent = "READY";
    } else {
      const d = Math.floor(diff / 86400000);
      const h = Math.floor((diff % 86400000) / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      countdown.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
  }

  window.addEventListener('resize', () => {
    initParticles();
    setupWheel();
  });

  window.onload = () => {
    initParticles();
    animateParticles();
    setupWheel();
    updateTimer();
    setInterval(updateTimer, 1000);
    
    // Automatically trigger spin on reload
    setTimeout(() => {
        spinToWinner('Khatija');
    }, 500); 
  };
})();
</script>
</body>
</html>